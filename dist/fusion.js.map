{"version":3,"sources":["utils.js","fusion.js"],"names":["readCookie","name","nameEQ","ca","document","cookie","split","i","length","c","charAt","substring","indexOf","createCookie","value","days","date","Date","setTime","getTime","expires","toGMTString","domain","window","location","hostname","generateUserId","replace","r","Math","random","v","toString","includes","str","needle","getBrowser","user_agent","vendor","opera","test","getBrowserVersion","userAgent","browser","regex","Chrome","Safari","Opera","Firefox","Konqueror","BlackBerry","Mozilla","undefined","matches","match","parseFloat","getOS","a","getDevice","getDeviceType","device","referringDomain","referrer","module","exports","autocaptureEnabled","script","createElement","src","type","getElementsByTagName","appendChild","Fusion","win","XMLHttpRequest","navigator","path","pathname","host","referrerDomain","deviceType","os","browserVersion","browserTimeZone","Intl","DateTimeFormat","resolvedOptions","timeZone","screenHeight","screen","height","screenWidth","width","userIP","city","country","user_id","device_id","libraryType","libraryVersion","fetch","then","res","json","out","ip","track","catch","console","log","userInfoCookieTemplate","initial_referrer","initial_referring_website","referring_website","userInfoCookie","apiKey","userInfoCookieString","JSON","stringify","encodeURIComponent","properties","property","propertiesToRegister","eventPropertyPayload","parse","decodeURIComponent","propertyToUnregister","savedPropertyPayload","event","userDefinedProperties","website","page","browser_version","device_type","screen_height","screen_width","library_type","library_version","propertiesToSend","Http","time","open","apiHost","send","api_key","api_host","autocapture_enabled","setup"],"mappings":"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","file":"fusion.js","sourceRoot":"../src","sourcesContent":["// Function Definition: Check & return cookie and if unavailable returns null\nfunction readCookie(name) {\n  var nameEQ = name + \"=\";\n  var ca = document.cookie.split(\";\");\n  for (var i = 0; i < ca.length; i++) {\n    var c = ca[i];\n    while (c.charAt(0) == \" \") c = c.substring(1, c.length);\n    if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);\n  }\n  return null;\n}\n\n// Function Definition: Create cookie @param1 = cookie name @param2 = cookie vale\n/**\n * @param  {string} name coookie name\n * @param  {string} value cookie value\n * @param  {number} days retention period of cookie on days\n */\nfunction createCookie(name, value, days) {\n  if (days) {\n    var date = new Date();\n    date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);\n    var expires = \"; expires=\" + date.toGMTString();\n  } else var expires = \"\";\n  let domain = window.location.hostname;\n  document.cookie = name + \"=\" + value + expires + \"; path=/; domain=\" + domain;\n}\n\n// Function Definition: Returns cryotographically unique user ids\n/** older version\n    function generateUserId() {\n      const typedArray = new Uint8Array(10);\n      const randomValues = window.crypto.getRandomValues(typedArray);\n      return randomValues.join(\"\");\n    }\n     */\n// RFC4122 version 4 compliant\nfunction generateUserId() {\n  return \"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g, function (c) {\n    var r = (Math.random() * 16) | 0,\n      v = c == \"x\" ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\nfunction includes(str, needle) {\n  return str.indexOf(needle) !== -1;\n}\n\n/**\n * * Detects the client browser type\n * ! Do not change the order of the checks done below as some\n * ! user agents include same keywords used in later checks.\n */\nfunction getBrowser(user_agent, vendor, opera) {\n  vendor = vendor || \"\"; // vendor is undefined for at least IE9\n  if (opera || includes(user_agent, \" OPR/\")) {\n    if (includes(user_agent, \"Mini\")) {\n      return \"Opera Mini\";\n    }\n    return \"Opera\";\n  } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n    return \"BlackBerry\";\n  } else if (\n    includes(user_agent, \"IEMobile\") ||\n    includes(user_agent, \"WPDesktop\")\n  ) {\n    return \"Internet Explorer Mobile\";\n  } else if (includes(user_agent, \"SamsungBrowser/\")) {\n    //? https://developer.samsung.com/internet/user-agent-string-format\n    return \"Samsung Internet\";\n  } else if (includes(user_agent, \"Edge\") || includes(user_agent, \"Edg/\")) {\n    return \"Microsoft Edge\";\n  } else if (includes(user_agent, \"FBIOS\")) {\n    return \"Facebook Mobile\";\n  } else if (includes(user_agent, \"Chrome\")) {\n    return \"Chrome\";\n  } else if (includes(user_agent, \"CriOS\")) {\n    return \"Chrome iOS\";\n  } else if (\n    includes(user_agent, \"UCWEB\") ||\n    includes(user_agent, \"UCBrowser\")\n  ) {\n    return \"UC Browser\";\n  } else if (includes(user_agent, \"FxiOS\")) {\n    return \"Firefox iOS\";\n  } else if (includes(vendor, \"Apple\")) {\n    if (includes(user_agent, \"Mobile\")) {\n      return \"Mobile Safari\";\n    }\n    return \"Safari\";\n  } else if (includes(user_agent, \"Android\")) {\n    return \"Android Mobile\";\n  } else if (includes(user_agent, \"Konqueror\")) {\n    return \"Konqueror\";\n  } else if (includes(user_agent, \"Firefox\")) {\n    return \"Firefox\";\n  } else if (includes(user_agent, \"MSIE\") || includes(user_agent, \"Trident/\")) {\n    return \"Internet Explorer\";\n  } else if (includes(user_agent, \"Gecko\")) {\n    return \"Mozilla\";\n  } else {\n    return \"\";\n  }\n}\n\n/**\n ** Detects the client browser version\n *  User agent strings referred from:\n *? http://www.useragentstring.com/pages/useragentstring.php\n */\nfunction getBrowserVersion(userAgent, vendor, opera) {\n  var browser = getBrowser(userAgent, vendor, opera);\n  var versionRegexs = {\n    \"Internet Explorer Mobile\": /rv:(\\d+(\\.\\d+)?)/,\n    \"Microsoft Edge\": /Edge?\\/(\\d+(\\.\\d+)?)/,\n    Chrome: /Chrome\\/(\\d+(\\.\\d+)?)/,\n    \"Chrome iOS\": /CriOS\\/(\\d+(\\.\\d+)?)/,\n    \"UC Browser\": /(UCBrowser|UCWEB)\\/(\\d+(\\.\\d+)?)/,\n    Safari: /Version\\/(\\d+(\\.\\d+)?)/,\n    \"Mobile Safari\": /Version\\/(\\d+(\\.\\d+)?)/,\n    Opera: /(Opera|OPR)\\/(\\d+(\\.\\d+)?)/,\n    Firefox: /Firefox\\/(\\d+(\\.\\d+)?)/,\n    \"Firefox iOS\": /FxiOS\\/(\\d+(\\.\\d+)?)/,\n    Konqueror: /Konqueror:(\\d+(\\.\\d+)?)/,\n    BlackBerry: /BlackBerry (\\d+(\\.\\d+)?)/,\n    \"Android Mobile\": /android\\s(\\d+(\\.\\d+)?)/,\n    \"Samsung Internet\": /SamsungBrowser\\/(\\d+(\\.\\d+)?)/,\n    \"Internet Explorer\": /(rv:|MSIE )(\\d+(\\.\\d+)?)/,\n    Mozilla: /rv:(\\d+(\\.\\d+)?)/,\n  };\n  var regex = versionRegexs[browser];\n  if (regex === undefined) {\n    return null;\n  }\n  var matches = userAgent.match(regex);\n  if (!matches) {\n    return null;\n  }\n  return parseFloat(matches[matches.length - 2]);\n}\n/**\n * Get OS name of client device\n */\nfunction getOS(userAgent) {\n  var a = userAgent;\n  if (/Windows/i.test(a)) {\n    if (/Phone/.test(a) || /WPDesktop/.test(a)) {\n      return \"Windows Phone\";\n    }\n    return \"Windows\";\n  } else if (/(iPhone|iPad|iPod)/.test(a)) {\n    return \"iOS\";\n  } else if (/Android/.test(a)) {\n    return \"Android\";\n  } else if (/(BlackBerry|PlayBook|BB10)/i.test(a)) {\n    return \"BlackBerry\";\n  } else if (/Mac/i.test(a)) {\n    return \"Mac OS X\";\n  } else if (/Linux/.test(a)) {\n    return \"Linux\";\n  } else if (/CrOS/.test(a)) {\n    return \"Chrome OS\";\n  } else {\n    return \"\";\n  }\n}\n/**\n * Get device from user agent string\n * @param  {} user_agent\n */\nfunction getDevice(user_agent) {\n  if (/Windows Phone/i.test(user_agent) || /WPDesktop/.test(user_agent)) {\n    return \"Windows Phone\";\n  } else if (/iPad/.test(user_agent)) {\n    return \"iPad\";\n  } else if (/iPod/.test(user_agent)) {\n    return \"iPod Touch\";\n  } else if (/iPhone/.test(user_agent)) {\n    return \"iPhone\";\n  } else if (/(BlackBerry|PlayBook|BB10)/i.test(user_agent)) {\n    return \"BlackBerry\";\n  } else if (/Android/.test(user_agent) && !/Mobile/.test(user_agent)) {\n    return \"Android Tablet\";\n  } else if (/Android/.test(user_agent)) {\n    return \"Android\";\n  } else {\n    return \"\";\n  }\n}\n/**\n * Detects device types eg:(desktop, tablet, mobile) using getDevice()\n * @param  {} user_agent\n */\nfunction getDeviceType(user_agent) {\n  const device = getDevice(user_agent);\n  if (device === \"iPad\" || device === \"Android Tablet\") {\n    return \"Tablet\";\n  } else if (device) {\n    return \"Mobile\";\n  } else {\n    return \"Desktop\";\n  }\n}\n\n/**\n * Returns domain name of referrer from referrer string\n * @param  {} referrer\n */\nfunction referringDomain(referrer) {\n  var split = referrer.split(\"/\");\n  if (split.length >= 3) {\n    return split[2];\n  }\n  return \"\";\n}\n\nmodule.exports = {\n  readCookie,\n  createCookie,\n  generateUserId,\n  getBrowser,\n  getBrowserVersion,\n  getOS,\n  getDevice,\n  getDeviceType,\n  referringDomain,\n};\n","/**\n *\n * * Fusion Analytcs Javascript Module\n *   Should be used with NPM based projects like NodeJS, React, Angular, Vue etc.\n *   Author: Vikas Singh\n *   Date: 02/08/21\n *   Version : BETA V1.0\n *\n */\n\n//TODO: Add autocaputre using vanilla js DOM events(scrap jquery)\n//TODO: Pageleave support\n\n//Load the jquery script\nvar script = document.createElement(\"SCRIPT\");\nscript.src = \"https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js\";\nscript.type = \"text/javascript\";\ndocument.getElementsByTagName(\"HEAD\")[0].appendChild(script);\nvar autocaptureEnabled;\n\nimport {\n  readCookie,\n  createCookie,\n  generateUserId,\n  getBrowser,\n  getBrowserVersion,\n  getOS,\n  getDeviceType,\n  referringDomain,\n} from \"./utils\";\n\nexport class Fusion {\n  setup() {\n    const Http = new XMLHttpRequest();\n    const libraryType = \"web\",\n      libraryVersion = \"1.0.0\",\n      win = typeof window !== \"undefined\" ? window : {},\n      navigator = win.navigator || { userAgent: \"\" },\n      document = win.document || {},\n      userAgent = navigator.userAgent;\n\n    // Get browser path,url\n    this.path = window.location.pathname;\n    this.host = window.location.host;\n\n    //get browser referrer\n    var referrer = document.referrer;\n    this.referrer = referrer;\n    this.referrerDomain = referringDomain(referrer);\n\n    this.deviceType = getDeviceType(userAgent);\n\n    // Get OS,Browser,DeviceType etc\n    this.os = getOS(userAgent);\n    this.browser = getBrowser(userAgent, navigator.vendor, window.opera);\n    this.browserVersion = getBrowserVersion(\n      userAgent,\n      navigator.vendor,\n      window.opera\n    );\n\n    //Get local timezone from browser to locate user indeirectly\n    this.browserTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;\n\n    // Device screen size\n    this.screenHeight = window.screen.height;\n    this.screenWidth = window.screen.width;\n\n    // Fetch user location data using third party IP lookup service\n    this.userIP = \"\";\n    this.city = \"\";\n    this.country = \"\";\n\n    this.user_id = \"\";\n    this.device_id = \"\";\n\n    this.libraryType = libraryType;\n    this.libraryVersion = libraryVersion;\n\n    // Fetch ip of user from ipify.org(third party service)\n    fetch(\"https://api64.ipify.org?format=json\")\n      .then((res) => res.json())\n      .then((out) => {\n        this.userIP = out.ip;\n        //Send page view data with location !\n        this.track(\"Pageview\", \"\");\n      })\n      .catch(() => {\n        //if location api not working just set location data to NULL\n        this.userIP = \"\";\n        console.log(\"sending pagview without location data..\");\n        this.track(\"Pageview\", \"\");\n      });\n\n    //data fileds for user info cookies\n    let userInfoCookieTemplate = {\n      user_id: `${this.user_id}`,\n      device_id: `${this.device_id}`,\n      initial_referrer: `${this.referrer || \"direct\"}`,\n      initial_referring_website: `${this.referrerDomain || \"direct\"}`,\n      referrer: `${this.referrer || \"direct\"}`,\n      referring_website: `${this.referrerDomain || \"direct\"}`,\n    };\n\n    // saving important reuseable info in browser cookie\n    this.userInfoCookie = readCookie(`fusion_${this.apiKey}`);\n    // check for info cookie existis and create one if unavaialable\n    if (this.userInfoCookie == null) {\n      this.user_id = generateUserId();\n      this.device_id = generateUserId();\n      userInfoCookieTemplate.user_id = this.user_id;\n      userInfoCookieTemplate.device_id = this.device_id;\n\n      //?UTM capability disable due to bug(malformed JSON while adding UTM data)\n      //   //get UTM data\n      //   const UTMdata = getCampaignParams();\n      //   //console.log(UTMdata);\n\n      //   // add UTM data to userInfoCookieTemplate & save in cookie if exists\n      //   for (const UTMTag in UTMdata) {\n      //     userInfoCookieTemplate[UTMTag] = `${UTMdata[UTMTag]}`;\n      //   }\n\n      // Stringify in save userInfo into cookie\n      let userInfoCookieString = JSON.stringify(userInfoCookieTemplate);\n      createCookie(\n        `fusion_${this.apiKey}`,\n        encodeURIComponent(userInfoCookieString),\n        730\n      );\n      this.userInfoCookie = readCookie(`fusion_${this.apiKey}`);\n      //console.log(this.userInfoCookie);\n    }\n  }\n\n  /**\n   ** Register super properties -(user defined property to be sent with all events)\n   * @param  {} properties -> super propery list json\n   */\n\n  register(properties) {\n    this.propertiesToRegister = properties;\n    //read data saved in cookie and parse it\n    this.eventPropertyPayload = JSON.parse(\n      decodeURIComponent(readCookie(`fusion_${this.apiKey}`))\n    );\n\n    // add property passed by user into property above parsed json\n    for (const property in this.propertiesToRegister) {\n      //console.log(`${property}: ${this.propertiesToRegister[property]}`);\n      this.eventPropertyPayload[\n        property\n      ] = `${this.propertiesToRegister[property]}`;\n    }\n    //encode stringify and save new userInfo(cookie saved data)\n    createCookie(\n      `fusion_${this.apiKey}`,\n      encodeURIComponent(JSON.stringify(this.eventPropertyPayload)),\n      730\n    );\n  }\n\n  /**\n   ** Unregister a super property -(used to remove register super properties)\n   * @param  {} property - super property name to delete from cookie\n   */\n  unregister(property) {\n    this.propertyToUnregister = property;\n\n    //read data saved in cookie and parse it\n    this.savedPropertyPayload = JSON.parse(\n      decodeURIComponent(readCookie(`fusion_${this.apiKey}`))\n    );\n    // remove property key-value passed by user from loaded property payload\n    delete this.savedPropertyPayload[`${this.propertyToUnregister}`];\n    //encode stringify and save new userInfo(cookie saved data)\n    createCookie(\n      `fusion_${this.apiKey}`,\n      encodeURIComponent(JSON.stringify(this.savedPropertyPayload)),\n      730\n    );\n  }\n\n  /**\n   *  Function Definition : Tracking function sends events with other data.\n   *  Can be callded from script tag or from html button/links/form\n   *  parameters:\n   *  event = String event name\n   *  data = String custom user defined data(can be kept empty as well)\n   **/\n\n  /**\n   ** Function Definition : Tracking function sends events with other data.\n   *  Can be callded from script tag or from html button/links/form\n   * @param  {} event -> event name\n   * @param  {} properties -> key-value pair json of properties\n   */\n\n  track(event, properties) {\n    this.event = event;\n    properties == undefined\n      ? this.userDefinedProperties == \"\"\n      : (this.userDefinedProperties = properties);\n\n    //read data saved in cookie and parse it\n    this.eventPropertyPayload = JSON.parse(\n      decodeURIComponent(readCookie(`fusion_${this.apiKey}`))\n    );\n\n    // add property passed by user into propery above parsed - eventPropertyPayload\n    for (const property in this.userDefinedProperties) {\n      //console.log(`${property}: ${this.propertiesToRegister[property]}`);\n      this.eventPropertyPayload[\n        property\n      ] = `${this.userDefinedProperties[property]}`;\n    }\n\n    //default super properties assigned by fusion.js\n    this.eventPropertyPayload.website = this.host;\n    this.eventPropertyPayload.page = this.path;\n    this.eventPropertyPayload.browser = this.browser;\n    this.eventPropertyPayload.browser_version = this.browserVersion;\n    this.eventPropertyPayload.os = this.os;\n    this.eventPropertyPayload.device_type = this.deviceType;\n    this.eventPropertyPayload.screen_height = this.screenHeight;\n    this.eventPropertyPayload.screen_width = this.screenWidth;\n    this.eventPropertyPayload.ip = this.userIP;\n    this.eventPropertyPayload.library_type = this.libraryType;\n    this.eventPropertyPayload.library_version = this.libraryVersion;\n    this.eventPropertyPayload.referrer = this.referrer || \"direct\";\n    this.eventPropertyPayload.referring_website =\n      this.referrerDomain || \"direct\";\n\n    //console.log(this.eventPropertyPayload);\n    this.propertiesToSend = JSON.stringify(this.eventPropertyPayload);\n    const Http = new XMLHttpRequest();\n    this.time = new Date().getTime();\n\n    Http.open(\n      \"GET\",\n      `${this.apiHost}/event?event=${this.event}&properties=${this.propertiesToSend}&timestamp=${this.time}&apiKey=${this.apiKey}`\n    );\n    Http.send();\n  }\n\n  /**\n   ** Main entry point of the tracking library\n   * That sets api_key, api_host and autocapture_enabled setting\n   * & calls setup() thus sends pageview event also\n   * @param api_key unique right-only key string for every users\n   * @param api_host tracking server url string\n   * @param autocapture_enabled if true event autocapture is enabled\n   */\n  init(api_key, api_host, autocapture_enabled) {\n    this.apiHost = api_host;\n    this.apiKey = api_key;\n    autocaptureEnabled = autocapture_enabled;\n    this.setup();\n  }\n}\n"]}